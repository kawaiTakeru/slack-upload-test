trigger: none

pool:
  name: Default  # â† ã‚ãªãŸã® Self-hosted Agent åã«åˆã‚ã›ã¦

variables:
  - name: System.Debug
    value: true

stages:
- stage: Stage3_Package
  displayName: 'ğŸ“¦ Slack DM Upload Test'
  condition: succeeded()  # æ˜ç¤ºçš„ã« stage å®Ÿè¡Œã‚’è¨±å¯
  jobs:
  - job: UploadTest
    displayName: 'Send dummy ZIP to Slack DM'
    condition: succeeded()  # æ˜ç¤ºçš„ã« job å®Ÿè¡Œã‚’è¨±å¯
    steps:
    - script: |
        echo "ğŸ§ª Checking files in stage3-package..."
        dir stage3-package
      displayName: 'ğŸ§ª Debug: List stage3-package contents'

    - task: PowerShell@2
      displayName: 'ğŸ“¤ Package and Notify via Slack'
      inputs:
        filePath: stage3-package/package_and_notify.ps1
        failOnStderr: true
      env:
        SLACK_BOT_TOKEN: $(SLACK_BOT_TOKEN)
        SLACK_USER_EMAIL: $(SLACK_USER_EMAIL)
